# Playbook 01: Vulnerability Triage

> SOC L1/L2 workflow for triaging new vulnerability findings using AI-assisted multi-tool correlation.

## MCP Servers Required

| Server | Purpose | Required |
|---|---|---|
| `ghas` | Pull Dependabot/CodeQL alerts | Yes |
| `semgrep` | Code-level vulnerability context | Yes |
| `snyk` | Reachability analysis, transitive deps | Recommended |
| `greynoise` | Active exploitation intelligence | Recommended |
| `opencti` | Threat actor campaign correlation | Optional |
| `security-detections` | Detection rule availability | Optional |
| `jira` | Ticket creation | Yes |
| `slack` | Team notification | Optional |

## Trigger

New critical/high vulnerability alert in GHAS, Semgrep, or Snyk.

## Workflow

### Step 1: Gather Context

**Prompt:**
```
A new critical Dependabot alert just came in for [CVE-ID] in [repo-name].
Pull the full alert details from GHAS including affected package, version,
and severity. Also check Semgrep for any related code scanning findings
in the same repository.
```

### Step 2: Enrichment

**Prompt:**
```
For [CVE-ID]:
1. Check GreyNoise — is this CVE being actively exploited in the wild?
2. Check OpenCTI — are there any threat actor campaigns targeting this vulnerability?
3. Check Snyk — is this dependency reachable in our code? Is it a direct or transitive dependency?
4. Check Security Detections — do we have Sigma/ESCU rules that would detect exploitation of this CVE?
```

### Step 3: Risk Assessment

**Prompt:**
```
Based on everything you've gathered, give me a risk assessment:
- Severity: Critical/High/Medium/Low
- Exploitability: Active/POC Available/Theoretical
- Reachability: Reachable/Not Reachable/Unknown
- Exposure: Internet-facing/Internal/Development only
- Recommended SLA: Immediate/48h/7d/30d
- Recommended priority: P1/P2/P3/P4
```

### Step 4: Create Ticket

**Prompt:**
```
Create a Jira ticket in the [PROJECT] project:
- Type: Bug (Security)
- Priority: [from risk assessment]
- Summary: "[CVE-ID] — [package] vulnerability in [repo]"
- Description: Include all findings from GHAS, exploitation status, reachability,
  and specific remediation steps (upgrade path, version to target)
- Labels: security, vulnerability, [severity]
- SLA: [from risk assessment]
```

### Step 5: Notify

**Prompt:**
```
Post a summary to Slack channel #vuln-triage with:
- CVE ID and severity
- Affected repos
- Whether it's actively exploited
- Jira ticket link
- Recommended action and timeline
```

## Decision Matrix

```
                        Actively Exploited?
                        Yes              No
                    ┌──────────┬──────────────┐
Reachable in   Yes  │ P1 — Now │ P2 — 48h     │
our code?           ├──────────┼──────────────┤
               No   │ P2 — 48h │ P3 — 7d      │
                    └──────────┴──────────────┘
```

## Example Session

```
Analyst: "New Dependabot critical for CVE-2024-50623 in our payments-api repo.
          Run the full triage playbook."

AI: [Queries GHAS] → Cleo Harmony RCE, affects file upload module
    [Queries GreyNoise] → Active mass exploitation, 2,400+ IPs scanning
    [Queries OpenCTI] → Linked to Cl0p ransomware campaigns
    [Queries Snyk] → Direct dependency, reachable in FileUploadController.java
    [Queries Detections] → 3 Sigma rules available, no ESCU coverage

    Risk Assessment:
    - Severity: CRITICAL
    - Exploitability: ACTIVE — mass exploitation confirmed
    - Reachability: CONFIRMED — direct dependency, reachable code path
    - Priority: P1 — IMMEDIATE
    - SLA: Deploy fix within 4 hours

    [Creates Jira P1 ticket PAYMENTS-4521]
    [Posts to #vuln-triage and #payments-team in Slack]
```
